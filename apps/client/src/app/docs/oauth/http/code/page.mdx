# 인증 코드 발급

### 엔드포인트

```http
POST /v1/oauth/code
```

### 설명

사용자의 이메일과 비밀번호를 사용하여 인증한 후, Authorization Code를 발급받습니다.
이 코드는 일회성이며 **5분의 유효기간**을 가집니다.

Authorization Code는 이후 `/v1/oauth/token` 엔드포인트에서 Access Token으로 교환됩니다.

### 요청 파라미터

모든 파라미터는 JSON 형식으로 요청 본문(body)에 포함되어야 합니다.

| 파라미터 | 타입 | 필수 여부 | 설명 | 예시 |
| --- | --- | --- | --- | --- |
| `email` | `String` | 필수 | 사용자의 DataGSM 이메일 주소 | `student@gsm.hs.kr` |
| `password` | `String` | 필수 | 사용자의 비밀번호 | `mypassword123` |
| `clientId` | `String` | 필수 | DataGSM에서 발급받은 클라이언트 ID | `your-client-id` |
| `redirectUrl` | `String` | 필수 | 인증 성공 후 리다이렉트될 URL (사전 등록 필요) | `https://your-app.com/callback` |

### 응답

#### 성공 응답 (200 OK)

```json
{
  "code": "abc123def456ghi789"
}
```

| 필드 | 타입 | 설명 |
| --- | --- | --- |
| `code` | `String` | Authorization Code (5분 유효, 일회성) |

### 오류 응답

| 상태 코드 | 설명 | 원인 |
| --- | --- | --- |
| `400 Bad Request` | 잘못된 요청 | 필수 파라미터 누락 또는 잘못된 형식 |
| `401 Unauthorized` | 인증 실패 | 이메일 또는 비밀번호가 올바르지 않음 |
| `404 Not Found` | 리소스를 찾을 수 없음 | 존재하지 않는 사용자 또는 등록되지 않은 클라이언트 |

### 요청 예시

#### cURL

```bash
curl -X POST "https://oauth.datagsm.com/v1/oauth/code" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "student@gsm.hs.kr",
    "password": "mypassword123",
    "clientId": "your-client-id",
    "redirectUrl": "https://your-app.com/callback"
  }'
```

### 응답 예시

#### 성공

```json
{
  "code": "8f3a9b2c1d4e5f6789abcdef01234567"
}
```

#### 실패 (401 Unauthorized)

```json
{
  "error": "unauthorized",
  "error_description": "Invalid email or password"
}
```

#### 실패 (400 Bad Request)

```json
{
  "error": "invalid_request",
  "error_description": "Missing required parameter: email"
}
```

### 사용 예제

다음은 여러 언어에서 인증 코드를 발급받는 예제입니다.

<CodeTabs>
  <CodeTab label="JavaScript" language="javascript" code={`async function getAuthorizationCode(email, password, clientId, redirectUrl) {
  try {
    const response = await fetch('https://oauth.datagsm.com/v1/oauth/code', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        email,
        password,
        clientId,
        redirectUrl,
      }),
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error_description || 'Failed to get authorization code');
    }

    const data = await response.json();
    return data.code;
  } catch (error) {
    console.error('Error:', error.message);
    throw error;
  }
}

// 사용 예시
const code = await getAuthorizationCode(
  'student@gsm.hs.kr',
  'mypassword123',
  'your-client-id',
  'https://your-app.com/callback'
);
console.log('Authorization Code:', code);`} />

  <CodeTab label="Python" language="python" code={`import requests

def get_authorization_code(email, password, client_id, redirect_url):
    """
    DataGSM OAuth 인증 코드를 발급받습니다.

    Args:
        email: 사용자 이메일
        password: 사용자 비밀번호
        client_id: 클라이언트 ID
        redirect_url: 리다이렉트 URL

    Returns:
        Authorization Code (string)
    """
    try:
        response = requests.post(
            'https://oauth.datagsm.com/v1/oauth/code',
            headers={'Content-Type': 'application/json'},
            json={
                'email': email,
                'password': password,
                'clientId': client_id,
                'redirectUrl': redirect_url,
            }
        )
        response.raise_for_status()
        data = response.json()
        return data['code']
    except requests.exceptions.RequestException as e:
        print(f'Error: {e}')
        raise

# 사용 예시
code = get_authorization_code(
    'student@gsm.hs.kr',
    'mypassword123',
    'your-client-id',
    'https://your-app.com/callback'
)
print(f'Authorization Code: {code}')`} />

  <CodeTab label="Java" language="java" code={`import java.net.http.*;
import java.net.URI;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.JsonNode;
import java.util.Map;

public class OAuthCodeService {
    private static final HttpClient client = HttpClient.newHttpClient();
    private static final ObjectMapper mapper = new ObjectMapper();

    public static String getAuthorizationCode(
        String email,
        String password,
        String clientId,
        String redirectUrl
    ) throws Exception {
        // 요청 본문 생성
        Map<String, String> requestBody = Map.of(
            "email", email,
            "password", password,
            "clientId", clientId,
            "redirectUrl", redirectUrl
        );

        String requestBodyJson = mapper.writeValueAsString(requestBody);

        // HTTP 요청 생성
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create("https://oauth.datagsm.com/v1/oauth/code"))
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(requestBodyJson))
            .build();

        // 요청 전송
        HttpResponse<String> response = client.send(
            request,
            HttpResponse.BodyHandlers.ofString()
        );

        // 응답 처리
        if (response.statusCode() != 200) {
            throw new RuntimeException("Failed to get authorization code: " + response.body());
        }

        JsonNode jsonNode = mapper.readTree(response.body());
        return jsonNode.get("code").asText();
    }

    public static void main(String[] args) throws Exception {
        String code = getAuthorizationCode(
            "student@gsm.hs.kr",
            "mypassword123",
            "your-client-id",
            "https://your-app.com/callback"
        );
        System.out.println("Authorization Code: " + code);
    }
}`} />

  <CodeTab label="Kotlin" language="kotlin" code={`import java.net.http.HttpClient
import java.net.http.HttpRequest
import java.net.http.HttpResponse
import java.net.URI
import com.fasterxml.jackson.module.kotlin.jacksonObjectMapper
import com.fasterxml.jackson.module.kotlin.readValue

data class CodeRequest(
    val email: String,
    val password: String,
    val clientId: String,
    val redirectUrl: String
)

data class CodeResponse(
    val code: String
)

class OAuthCodeService {
    private val client = HttpClient.newHttpClient()
    private val mapper = jacksonObjectMapper()

    fun getAuthorizationCode(
        email: String,
        password: String,
        clientId: String,
        redirectUrl: String
    ): String {
        val requestBody = CodeRequest(email, password, clientId, redirectUrl)
        val requestBodyJson = mapper.writeValueAsString(requestBody)

        val request = HttpRequest.newBuilder()
            .uri(URI.create("https://oauth.datagsm.com/v1/oauth/code"))
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(requestBodyJson))
            .build()

        val response = client.send(request, HttpResponse.BodyHandlers.ofString())

        if (response.statusCode() != 200) {
            throw RuntimeException("Failed to get authorization code: \${response.body()}")
        }

        val codeResponse: CodeResponse = mapper.readValue(response.body())
        return codeResponse.code
    }
}

// 사용 예시
fun main() {
    val service = OAuthCodeService()
    val code = service.getAuthorizationCode(
        email = "student@gsm.hs.kr",
        password = "mypassword123",
        clientId = "your-client-id",
        redirectUrl = "https://your-app.com/callback"
    )
    println("Authorization Code: $code")
}`} />
</CodeTabs>

### 보안 주의사항

#### 비밀번호 전송

- 이 엔드포인트는 사용자의 비밀번호를 전송하므로 **반드시 HTTPS**를 사용해야 합니다.
- HTTP를 사용하면 비밀번호가 평문으로 전송되어 중간자 공격에 취약합니다.

#### Code 유효기간

- Authorization Code는 **5분 후 자동으로 만료**됩니다.
- 만료된 Code는 사용할 수 없으므로, 발급 후 즉시 Token 교환을 수행하세요.

#### 일회성 사용

- Authorization Code는 **한 번만 사용**할 수 있습니다.
- 동일한 Code로 두 번째 Token 교환을 시도하면 실패합니다.

#### 리다이렉트 URI 검증

- `redirectUrl`은 DataGSM에 사전 등록된 URI와 정확히 일치해야 합니다.
- 등록되지 않은 URI를 사용하면 `403 Forbidden` 오류가 발생합니다.

### 다음 단계

Authorization Code를 발급받았다면, 다음 단계로 Token 교환을 진행하세요.

- [토큰 교환](/docs/oauth/http/token) - Authorization Code를 Access Token으로 교환
- [사용자 정보 조회](/docs/oauth/http/userinfo) - Access Token으로 사용자 정보 획득
