import { Shield } from 'lucide-react'

# OAuth

### 개요

DataGSM OAuth는 OAuth 2.0 Authorization Code Grant 플로우를 기반으로 한 인증 시스템입니다. 사용자는 DataGSM 계정으로 서드파티 애플리케이션에 안전하게 로그인할 수 있으며, 애플리케이션은 사용자의 동의 하에 사용자 정보에 접근할 수 있습니다. OAuth 2.0은 업계 표준 인증 프로토콜로, 사용자 비밀번호를 직접 공유하지 않고도 안전하게 리소스 접근 권한을 부여할 수 있습니다.

<div className="border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/20 p-4 rounded my-6">
  <div className="flex items-start gap-3">
    <Shield className="h-5 w-5 text-blue-500 shrink-0 mt-0.5" />
    <div>
      <div className="font-semibold text-blue-900 dark:text-blue-100 mb-1">
        PKCE 강력 권장
      </div>
      <div className="text-blue-800 dark:text-blue-200 text-sm">
        DataGSM OAuth는 <strong>PKCE (RFC 7636)</strong>를 지원합니다. PKCE는 Authorization Code 탈취 공격을 방지하는 보안 확장으로,
        <strong>SPA, 모바일 앱 등 Public Client에서 강력히 권장</strong>됩니다.
        PKCE 구현 방법은 <a href="/docs/oauth/http/code" className="underline">HTTP API 문서</a>를 참고하세요.
      </div>
    </div>
  </div>
</div>

### 주요 특징

| 특징            | 설명                                                                      |
|---------------|-------------------------------------------------------------------------|
| **JWT 기반 토큰** | 모든 Access Token은 JWT(JSON Web Token) 형식으로 발급되어 서명 검증이 가능합니다.            |
| **PKCE 지원**   | Authorization Code 탈취 방지를 위해 PKCE (RFC 7636) 표준을 지원합니다.                  |
| **Redis 캐싱**  | Redis를 활용하여 토큰 정보를 캐싱하고 빠른 검증을 제공합니다.                                   |
| **토큰 유효기간**   | Access Token 1시간, Refresh Token 30일, Authorization Code 5분의 유효기간을 가집니다. |
| **보안 강화**     | HTTPS 필수, Client Secret 기반 인증, State 파라미터를 통한 CSRF 방지를 지원합니다.           |
| **표준 준수**     | OAuth 2.0 RFC 6749 및 PKCE RFC 7636 표준을 준수합니다.                            |

### 시스템 요구사항

| 항목            | 요구사항                                      |
|---------------|-------------------------------------------|
| **프로토콜**      | HTTPS 필수 (개발 환경 제외)                       |
| **리다이렉트 URI** | 사전 등록된 리다이렉트 URI만 허용                      |
| **Client 등록** | DataGSM에서 Client ID 및 Client Secret 발급 필요 |

### 기본 개념

#### Authorization Code

사용자 로그인 성공 시 발급되는 일회성 코드입니다. Access Token으로 교환되며, **5분의 유효기간**을 가집니다.

#### Access Token

사용자 리소스에 접근하기 위한 JWT 토큰입니다. **1시간의 유효기간**을 가지며, API 요청 시 `Authorization: Bearer` 헤더에 포함하여 사용합니다.

#### Refresh Token

Access Token 만료 시 새로운 Access Token을 발급받기 위한 토큰입니다. **30일의 유효기간**을 가집니다.

#### Client Credentials

- **Client ID**: 애플리케이션을 식별하는 공개 식별자 (프론트엔드 사용 가능)
- **Client Secret**: 애플리케이션의 비밀 키 (**반드시 서버에서만 사용**, 노출 금지)

### 인증 플로우

DataGSM OAuth의 Authorization Code Grant 플로우는 다음과 같이 동작합니다.

```mermaid
sequenceDiagram
    participant U as 사용자(브라우저)
    participant C as 클라이언트 애플리케이션
    participant O as DataGSM OAuth

    U->>C: 1. 로그인 버튼 클릭
    C->>C: 2. PKCE code_verifier 생성 및 저장
    C->>C: 3. code_challenge 생성 (SHA-256)
    C->>O: 4. 인증 요청\n(clientId, redirectUri, code_challenge)
    O-->>U: 5. 로그인 페이지로 리다이렉트
    U->>O: 6. 이메일 / 비밀번호 입력
    O-->>U: 7. Authorization Code와 함께 리다이렉트
    U->>C: 8. Code를 애플리케이션에 전달
    C->>O: 9. Token 요청\n(code, code_verifier, clientSecret)
    O->>O: 10. PKCE 검증
    O-->>C: 11. Access Token & Refresh Token 발급
    C->>O: 12. UserInfo 요청\n(Bearer Token)
    O-->>C: 13. 사용자 정보 응답
    C-->>U: 14. 로그인 완료
```

인증 플로우는 다음 단계로 진행됩니다:

1. 사용자가 로그인 버튼 클릭
2. 클라이언트가 PKCE `code_verifier` 생성 및 저장
3. `code_verifier`를 SHA-256 해싱하여 `code_challenge` 생성
4. OAuth 서버로 인증 요청 (client_id, redirect_uri, code_challenge 포함)
5. 사용자가 로그인 페이지에서 이메일/비밀번호 입력
6. 인증 성공 시 Authorization Code 발급 및 리다이렉트
7. 클라이언트 서버가 Token 교환 요청 (code, code_verifier, client_secret)
8. OAuth 서버가 PKCE 검증 후 Access Token 및 Refresh Token 발급
9. Access Token으로 사용자 정보 요청 및 로그인 완료

### 보안 가이드라인

OAuth 인증을 안전하게 구현하기 위한 주요 가이드라인입니다.

#### HTTPS 필수

모든 OAuth 통신은 **반드시 HTTPS**를 사용해야 합니다. HTTP는 토큰 탈취 위험이 있으므로 프로덕션 환경에서 사용 금지입니다. (개발 환경 localhost 예외)

#### Client Secret 관리

Client Secret은 **절대 프론트엔드 코드에 포함하거나 공개 저장소에 커밋하지 마세요.** 환경 변수나 보안 볼트에 안전하게 저장하고, 주기적으로 로테이션하는 것을 권장합니다.

#### State 파라미터

CSRF 공격 방지를 위해 `state` 파라미터를 사용하세요. 랜덤 문자열을 생성하여 요청 시 전송하고, 콜백에서 검증합니다.

#### 토큰 저장

Access Token은 메모리나 sessionStorage에, Refresh Token은 서버 측 세션이나 HttpOnly 쿠키에 저장하세요. localStorage는 XSS 공격에 취약하므로 사용을 지양합니다.

### 시작하기

DataGSM OAuth를 사용하는 세 가지 방법입니다.

#### HTTP API

REST API를 직접 호출하여 구현합니다. 가장 유연하지만 구현 복잡도가 높습니다. [HTTP API 문서](/docs/oauth/http), [인증 코드 발급](/docs/oauth/http/code), [토큰 교환](/docs/oauth/http/token), [토큰 갱신](/docs/oauth/http/tokens), [사용자 정보 조회](/docs/oauth/http/userinfo)

#### SDK

공식 SDK를 사용하면 OAuth 플로우를 간단하게 구현할 수 있습니다. [React SDK](/docs/oauth/sdk/react), [Java/Kotlin SDK](/docs/oauth/sdk/java)

#### 실전 예제

프레임워크별 완전한 구현 예제를 제공합니다. [Next.js + Spring Boot](/docs/oauth/examples/nextjs-spring-boot), [React + Spring Boot (Kotlin)](/docs/oauth/examples/react-spring-boot-kotlin), [Vanilla JS + NestJS](/docs/oauth/examples/vanilla-nestjs)

### API 엔드포인트

```
https://oauth.data.hellogsm.kr          # OAuth 인증 서버
https://oauth-userinfo.data.hellogsm.kr # 사용자 정보 서버
```

### 지원

OAuth 관련 문의는 GitHub Issues를 이용하세요. [DataGSM Front Issues](https://github.com/themoment-team/datagsm-front/issues), [DataGSM Server Issues](https://github.com/themoment-team/datagsm-server/issues)
